#include "gameboy.h"
#include "timer.h"

void		div_timer(t_gameboy *gb)
{
  if (gb->timer.div_counter > DIV_INC_FREQUENCY / GB_CPU_FREQUENCY) {
  }

}

void		timer_step(t_gameboy *gb)
{
  static unsigned const timings[] = { 4096, 262144, 65536, 16384 };
  unsigned char	tac = *gb->hregisters.tac;

  static unsigned i = 0;
  ++i;
  if (!(tac & TC_TIMER_STOP))
    return ;

  unsigned clock_select = timings[tac & TC_CLOCK_SELECT] / GB_CPU_FREQUENCY;

  gb->timer.timer_counter += gb->instruction.cycles;

  if (gb->timer.timer_counter >= clock_select)
    {
      gb->timer.timer_counter -= clock_select;
      if (*gb->hregisters.tima == 0xFF)
	*gb->hregisters.tima = *gb->hregisters.tma;
      else
	++(*gb->hregisters.tima);
    }
}
